import{P as t,j as e,p as k,d as N,s as P}from"./index-7b6980cd.js";import{a as J,c as L,d as A,u as q,s as F,b as $,f as K}from"./fbStore-ed2d4d67.js";import{r as x}from"./react-25ab5c11.js";import{Q as w}from"./react-toastify.esm-d682d2c7.js";import{r as B,u as E,a as I}from"./fbStorage-a10cdba0.js";import{B as M}from"./BannerSection-3249598e.js";import{s}from"./Community.module-49769493.js";import{d as W,u as O,e as V}from"./reactRouter-bcec4121.js";import"./recoil-219bc644.js";import"./fbAuth-9e87268e.js";import"./fbApp-26a327c1.js";function z({title:o,setTitle:i,content:l,setContent:u,imagePreview:d,setImagePreview:p,selectedFile:n,setSelectedFile:R}){const v=m=>{i(m.target.value)},h=m=>{u(m.target.value)},y=m=>{const r=m.target.files[0];if(r&&r.type.startsWith("image/")){const c=new FileReader;c.onload=()=>{p(c.result)},c.readAsDataURL(r)}else p(null);R(r);const g=document.getElementById("fileName");g&&(g.value=r?r.name:"첨부파일")};return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"sr-only",children:"커뮤니티 폼 입력 섹션"}),e.jsx("div",{className:s.titleWrapper,children:e.jsx("input",{type:"text",placeholder:"제목을 입력하세요.",className:s.title,value:o,onChange:v})}),e.jsxs("div",{className:s.contentWrapper,children:[e.jsxs("div",{className:s.imageContainer,children:[d?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:d,alt:"이미지 미리보기",className:s.imagePreview}),e.jsx("label",{htmlFor:"file",className:s.imageLabel,children:"이미지 변경"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:n?n.name:"첨부파일",id:"fileName",placeholder:"첨부파일",onChange:()=>{},className:s.imageInput}),e.jsx("label",{htmlFor:"file",className:s.imageLabel,children:"파일 찾기"})]}),e.jsx("input",{type:"file",id:"file",onChange:y,className:"w-0 h-0"})]}),e.jsx("textarea",{placeholder:"내용을 입력해주세요.",rows:10,className:s.contentText,value:l,onChange:h})]})]})}z.propTypes={title:t.string.isRequired,setTitle:t.func.isRequired,content:t.string.isRequired,setContent:t.func.isRequired,imagePreview:t.string.isRequired,setImagePreview:t.func.isRequired,selectedFile:t.shape({name:t.string,type:t.string}).isRequired,setSelectedFile:t.func.isRequired};function Q({isEditing:o,handleSave:i}){const l=W(),u=()=>{w.done("변경을 취소했습니다."),l(-1)};return e.jsxs("section",{className:s.buttonWrapper,children:[e.jsx("p",{className:"sr-only",children:"커뮤니티 폼 버튼 섹션"}),e.jsx("button",{type:"button",className:`${s.button} bg-blue-400`,onClick:i,children:e.jsx("span",{className:"block font-medium",children:o?"수정하기":"등록하기"})}),e.jsx("button",{type:"button",className:`${s.button} bg-red-400`,onClick:u,children:e.jsx("span",{className:"block font-medium",children:"취소하기"})})]})}Q.propTypes={isEditing:k.PropTypes.bool.isRequired,handleSave:k.PropTypes.func.isRequired};function G({isEditing:o=!1,data:i=null}){const[l,u]=x.useState(""),[d,p]=x.useState(""),[n,R]=x.useState(null),[v,h]=x.useState(null),y=W(),m=O(),{currentNotice:r,notices:g}=m.state||{},{id:c}=V();x.useEffect(()=>{o&&i&&(u(i.title),p(i.content),h(i.imageUrl))},[o,r]);const H=async()=>{try{const S=await J(L(N,"community")),U=S.size>0?S.size-1:0;if(o){const a=A(N,"community",c);if(await q(a,{title:l,content:d,updatedAt:F()}),n){const C=B(P,`images/community/${c}`);await E(C,n);const D=await I(C);await q(a,{imageUrl:D})}w.success("글이 수정되었습니다.");const f=(await $(a)).data();y(`/community/${c}`,{state:{notices:g,currentNotice:{id:c,data:f}}})}else{const a=await K(L(N,"community"),{index:U,title:l,content:d,imageUrl:null,updatedAt:F()});let b;if(n){const j=B(P,`images/community/${a.id}`);await E(j,n),b=await I(j);const T=A(N,"community",a.id);await q(T,{imageUrl:b})}const f=[...g,{id:a.id,data:{index:U,title:l,content:d,imageUrl:n?b:null,updatedAt:F()}}];w.success("글이 등록되었습니다.");const D=(await $(a)).data();y(`/community/${a.id}`,{state:{notices:f==null?void 0:f.slice().toSorted((j,T)=>T.data.index-j.data.index),currentNotice:{id:a.id,data:D}}})}}catch{w.error("변경 실패하였습니다. 다시 한번 확인해주세요.")}};return e.jsxs("div",{className:"mb-open-5xl w-full h-full desktop:px-open-margin-desktop tablet:px-open-margin-desktop px-open-gutter-mobile",children:[e.jsx(M,{category:"Support",title:"커뮤니티"}),e.jsxs("div",{className:"flex flex-col px-open-gutter-mobile desktop:px-open-gutter-desktop ",children:[e.jsx(z,{title:l,setTitle:u,content:d,setContent:p,selectedFile:n,setSelectedFile:R,imagePreview:v,setImagePreview:h}),e.jsx(Q,{isEditing:o,handleSave:H})]})]})}G.propTypes={isEditing:t.bool,data:t.shape({index:t.number,title:t.string,content:t.string,imageUrl:t.string,updatedAt:t.shape({seconds:t.number,nanoseconds:t.number})})};G.defaultProps={isEditing:!1,data:{index:0,title:"",content:"",imageUrl:"",updatedAt:{seconds:0,nanoseconds:0}}};export{G as default};
